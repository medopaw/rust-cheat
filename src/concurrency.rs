/*
===============================================================
05. å¹¶å‘ç¼–ç¨‹æ¨¡å¼ - AI Coding å¿«é€Ÿç†è§£æŒ‡å—
===============================================================

ğŸ¯ ä¸šåŠ¡åœºæ™¯ï¼š
- Web æœåŠ¡ï¼šå¹¶å‘å¤„ç†å¤šä¸ªè¯·æ±‚ï¼Œæå‡ååé‡
- æ‰¹é‡æ“ä½œï¼šåŒæ—¶å¤„ç†å¤šä¸ª API è°ƒç”¨ã€æ–‡ä»¶æ“ä½œ
- è¶…æ—¶æ§åˆ¶ï¼šç½‘ç»œè¯·æ±‚ã€æ•°æ®åº“æŸ¥è¯¢çš„æ—¶é—´é™åˆ¶
- åå°ä»»åŠ¡ï¼šæ—¥å¿—å†™å…¥ã€ç¼“å­˜åˆ·æ–°ã€å®šæ—¶ä»»åŠ¡

ğŸ” 30ç§’è¯†åˆ«å¹¶å‘æ¨¡å¼ï¼š
- çœ‹ join!/try_join!ï¼šç­‰å¾…å¤šä¸ªä»»åŠ¡å…¨éƒ¨å®Œæˆï¼Œæ”¶é›†ç»“æœ
- çœ‹ select!ï¼šç­‰å¾…å¤šä¸ªä»»åŠ¡ï¼Œä»»ä¸€å®Œæˆå°±ç»§ç»­ï¼ˆå¸¸ç”¨äºè¶…æ—¶ï¼‰
- çœ‹ spawnï¼šåˆ›å»ºç‹¬ç«‹åå°ä»»åŠ¡ï¼Œä¸é˜»å¡å½“å‰æ‰§è¡Œ
- çœ‹é”™è¯¯ä¼ æ’­ï¼štry_join! ä»»ä¸€å¤±è´¥åˆ™æ•´ä½“å¤±è´¥

âš ï¸ AI å¸¸è§å¹¶å‘é”™è¯¯ï¼š
âŒ å¿˜è®° .await join handleï¼Œå¯¼è‡´ä»»åŠ¡å¯èƒ½è¢«å–æ¶ˆ
âŒ åœ¨ select! ä¸­ä½¿ç”¨å¯èƒ½ panic çš„ä»£ç 
âŒ spawn åä¸å¤„ç† JoinErrorï¼ˆä»»åŠ¡ panic ä¼šè¢«å¿½ç•¥ï¼‰
âŒ è¿‡åº¦å¹¶å‘å¯¼è‡´èµ„æºè€—å°½ï¼ˆå¦‚æ‰“å¼€å¤ªå¤šç½‘ç»œè¿æ¥ï¼‰
âŒ æ•°æ®ç«äº‰ï¼šå¤šä¸ªä»»åŠ¡åŒæ—¶ä¿®æ”¹å…±äº«çŠ¶æ€

âœ… Review æ¸…å•ï¼š
- [ ] æ˜¯å¦æœ‰æ•°æ®ç«äº‰é£é™©ï¼Ÿï¼ˆæ£€æŸ¥å…±äº«å¯å˜çŠ¶æ€ï¼‰
- [ ] é”™è¯¯æ˜¯å¦æ­£ç¡®ä¼ æ’­å’Œå¤„ç†ï¼Ÿ
- [ ] æ˜¯å¦æœ‰æ­»é”å¯èƒ½ï¼Ÿï¼ˆå¦‚å¾ªç¯ç­‰å¾…ï¼‰
- [ ] èµ„æºæ˜¯å¦åˆç†é™åˆ¶ï¼Ÿï¼ˆè¿æ¥æ± ã€å¹¶å‘æ•°é™åˆ¶ï¼‰
- [ ] spawn çš„ä»»åŠ¡æ˜¯å¦æœ‰é€‚å½“çš„é”™è¯¯å¤„ç†ï¼Ÿ

ğŸ“– é˜…è¯»é¡ºåºï¼š
1. å…ˆçœ‹å¹¶å‘ç­–ç•¥ï¼ˆjoin ç­‰å¾…å…¨éƒ¨ vs select ç­‰å¾…ä»»ä¸€ï¼‰
2. å†çœ‹é”™è¯¯å¤„ç†ï¼ˆtry_join çš„çŸ­è·¯ vs ä¸ªåˆ«ä»»åŠ¡å®¹é”™ï¼‰
3. æœ€åçœ‹èµ„æºç®¡ç†ï¼ˆspawn çš„ç”Ÿå‘½å‘¨æœŸï¼Œæ˜¯å¦éœ€è¦å–æ¶ˆï¼‰

æ ¸å¿ƒå¹¶å‘æ¨¡å¼ï¼š

// åŸºæœ¬çš„å¹¶å‘æ¨¡å¼ï¼ˆéœ€ tokio ä¾èµ–ï¼‰
use tokio::try_join;
async fn a() -> anyhow::Result<i32> { Ok(1) }
async fn b() -> anyhow::Result<i32> { Ok(2) }
async fn run_join() -> anyhow::Result<()> {
    let (x, y) = try_join!(a(), b())?; // ä»»ä¸€ Err ç›´æ¥è¿”å› Err
    println!("{}", x + y);
    Ok(())
}

use tokio::{select, time::{sleep, Duration}};
async fn run_select() {
    select! {
        _ = sleep(Duration::from_secs(1)) => println!("timeout"),
        _ = async_work() => println!("done"),
    }
}

// åå°ä»»åŠ¡ï¼š
let handle = tokio::spawn(async { 42 });
let val = handle.await?; // JoinHandle<Result<T, JoinError>>
*/

pub fn concurrency_concepts() {
    println!("å¹¶å‘æ¦‚å¿µæ¼”ç¤ºï¼š");
    println!("- join! : ç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆ");
    println!("- try_join! : ç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆï¼Œä»»ä¸€å¤±è´¥åˆ™è¿”å›é”™è¯¯");
    println!("- select! : ç­‰å¾…ä»»ä¸€ä»»åŠ¡å®Œæˆ");
    println!("- spawn : åˆ›å»ºç‹¬ç«‹çš„åå°ä»»åŠ¡");
}

// æ¨¡æ‹Ÿå¹¶å‘æ“ä½œ
pub fn simulate_concurrent_work() {
    println!("æ¨¡æ‹Ÿå¹¶å‘å·¥ä½œï¼š");
    println!("1. å¯åŠ¨å¤šä¸ªä»»åŠ¡");
    println!("2. ç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆ");
    println!("3. å¤„ç†ç»“æœæˆ–é”™è¯¯");
}